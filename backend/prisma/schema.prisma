// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String   @id @default(uuid())
  email          String   @unique
  password       String
  name           String
  role           Role
  driver         Driver?
  passengerRides Ride[]   @relation("PassengerRides")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Driver {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  lat         Float
  lng         Float
  heading     Float
  isOnline    Boolean  @default(false)
  isInRide    Boolean  @default(false)
  lastUpdated DateTime @default(now())
  rides       Ride[]

  @@index([lat, lng])
}

model Ride {
  id              String     @id @default(uuid())
  pickupLat       Float
  pickupLng       Float
  pickupName      String
  destLat         Float
  destLng         Float
  destName        String
  baseFare        Decimal    @default(0)
  distanceFare    Decimal    @default(0)
  timeFare        Decimal    @default(0)
  surgeMultiplier Float      @default(1.0)
  totalFare       Decimal
  status          RideStatus @default(REQUESTED)
  passengerId     String
  passenger       User       @relation("PassengerRides", fields: [passengerId], references: [id])
  driverId        String?
  driver          Driver?    @relation(fields: [driverId], references: [id])
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

model PricingConfig {
  id              String   @id @default(uuid())
  baseFare        Decimal
  perKmRate       Decimal
  perMinuteRate   Decimal
  surgeMultiplier Float    @default(1.0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
}

enum Role {
  PASSENGER
  DRIVER
}

enum RideStatus {
  REQUESTED
  ACCEPTED
  STARTED
  COMPLETED
  CANCELLED
}
